/*! angular-facebook-insight - v0.6.42 - 2014-11-07
* Copyright (c) 2014 ; Licensed  */
"use strict";angular.module("angular-facebook-insight-tpls",["templates/fb-insight-geomap.html","templates/fb-insight-map.html","templates/fb-insight-pie.html","templates/fb-insight-bar.html","templates/fb-insight-gauge.html","templates/fb-insight-reach.html","templates/fb-insight-spider.html","templates/fb-post-details.html"]),angular.module("angular-facebook-insight-tpls",["templates/fb-insight-geomap.html","templates/fb-insight-map.html","templates/fb-insight-pie.html","templates/fb-insight-bar.html","templates/fb-insight-gauge.html","templates/fb-insight-reach.html","templates/fb-insight-spider.html","templates/fb-post-details.html"]),angular.module("angular-facebook-insight",["nvd3ChartDirectives","googlechart","angular-facebook-insight-tpls"]).service("Parser",["$filter",function(){return{getMapData:function(a,b){for(var c=[],d=a.length-1;d>=0;d--){var e=[b];for(var f in a[d].value){var g=f;f.indexOf(",")>-1&&(g=f.split(",")[0]),e.push([g,g+": "+a[d].value[f]])}c.push(e)}return c},getGeoMapData:function(a,b){for(var c=[],d=a.length-1;d>=0;d--){var e=[b];for(var f in a[d].value){var g=f;f.indexOf("_")>-1&&(g=f.split("_")[1]),e.push([g,a[d].value[f]])}c.push(e)}return c},getGauge:function(a,b){return{options:{chart:{type:"solidgauge"},pane:{center:["50%","60%"],startAngle:-90,endAngle:90,background:{backgroundColor:"#fff",innerRadius:"90%",outerRadius:"100%",shape:"arc"}},solidgauge:{dataLabels:{y:-30,borderWidth:0,useHTML:!0}},plotOptions:{solidgauge:{innerRadius:"90%",dataLabels:{y:-45,borderWidth:0,useHTML:!0}}}},series:[{data:[a],dataLabels:{format:'<div style="text-align:center"><span style="font-size:25px;color:#444">{y}</span><span style="font-size:12px;color:silver"> %</span></div>'}}],title:{text:b,y:50},credits:{enabled:!1},yAxis:{currentMin:0,currentMax:100,title:{y:140},stops:[[.1,"#DF5353"],[.5,"#DDDF0D"],[.9,"#55BF3B"]],lineWidth:0,minorTickInterval:null,tickPixelInterval:400,tickWidth:0,startOnTick:!0,labels:{y:15}},loading:!1}},getPie:function(a,b,c){return{series:[{type:"pie",name:c,data:a}],title:{text:b},loading:!1,credits:{enabled:!1}}},getBar:function(a,b,c,d,e){return{chart:{type:"bar"},title:{text:d},xAxis:{categories:b},yAxis:{min:0},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",shadow:!0},credits:{enabled:!1},series:[{name:e,type:"column",data:a,color:c,id:"series-3"}]}},getSpider:function(a,b,c,d,e){return{options:{chart:{polar:!0,type:"line"}},title:{text:d},pane:{size:"100%"},xAxis:{categories:a,tickmarkPlacement:"on",lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},tooltip:{shared:!0,pointFormat:'<span style="color:{series.color}">{series.name}: <b>${point.y:,.0f}</b><br/>'},legend:{align:"right",verticalAlign:"top",y:70,layout:"vertical"},credits:{enabled:!1},series:[{name:e,data:b,pointPlacement:"on"}]}}}}]).service("Facebook",["$rootScope",function(a){return{getUserAndAccount:function(){FB.getLoginStatus(function(b){"connected"!==b.status?FB.login(function(b){a.$broadcast("token",b.authResponse.accessToken)},{scope:"read_insights,manage_pages"}):a.$broadcast("token",b.authResponse.accessToken)})}}}]).service("FacebookInsightService",["$rootScope","$q","Parser",function(a,b,c){var d=function(a){var c=b.defer();return FB.api("/me/accounts?access_token="+a,function(a){c.resolve(a.data)}),c.promise},e=function(a,c,d){var e=b.defer(),f="/"+a+"/feed?access_token="+c;return angular.isDefined(d)&&(f=d),FB.api(f,function(a){e.resolve(a)}),e.promise},f=function(a,c){var d=b.defer();return FB.api("/"+a+"/insights?access_token="+c,function(a){d.resolve(h(a.data))}),d.promise},g=function(a,c){var d=b.defer();return FB.api("/"+a+"/insights?access_token="+c,function(a){d.resolve(h(a.data))}),d.promise},h=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a[c].name]=a[c];return b},i=function(a){var b=[a.post_storytellers_by_action_type.values[0].value.like,a.post_storytellers_by_action_type.values[0].value.comment,a.post_storytellers_by_action_type.values[0].value.share];return c.getBar(b,["Likes","Comments","Share"],"#1ea3e8","Engagement par type","Type d'engagement")},j=function(a){var b=a.post_negative_feedback_by_type_unique.values[0].value,d=angular.isDefined(b.hide_clicks)?b.hide_clicks:0,e=angular.isDefined(b.hide_all_clicks)?b.hide_all_clicks:0,f=angular.isDefined(b.report_spam)?b.report_spam:0,g=[d,e,f];return c.getBar(g,["Hide clicks","Hide all clicks","Report Spam"],"#fc6042","Retours negatif par type","Type de retour")},k=function(a){var b=[["Payant",a.post_impressions_by_paid_non_paid.values[0].value.paid],{name:"Naturel",y:a.post_impressions_by_paid_non_paid.values[0].value.unpaid,sliced:!0,selected:!0}];return c.getPie(b,"Reach Facebook Naturel Vs Payant","Impression share")},l=function(a){return a.post_impressions_unique.values[0].value},m=function(a){var b=a.post_story_adds_by_action_type_unique,c=a.post_impressions_unique,d=angular.isDefined(b.values[0].value.like)?b.values[0].value.like:0,e=angular.isDefined(b.values[0].value.comment)?b.values[0].value.comment:0,f=angular.isDefined(b.values[0].value.share)?b.values[0].value.share:0,g=0;return c.values[0].value>0&&(g=Math.round((e+d+f)/c.values[0].value*100)),g},n=function(a){var b=a.post_consumptions_by_type_unique,c=a.post_story_adds_by_action_type_unique,d=angular.isDefined(c.values[0].value.like)?c.values[0].value.like:0,e=angular.isDefined(c.values[0].value.comment)?c.values[0].value.comment:0,f=angular.isDefined(c.values[0].value.share)?c.values[0].value.share:0,g=angular.isDefined(b.values[0].value["photo view"])?b.values[0].value["photo view"]:0,h=angular.isDefined(b.values[0].value["other clicks"])?b.values[0].value["other clicks"]:0,i=angular.isDefined(b.values[0].value["link clicks"])?b.values[0].value["link clicks"]:0,j=Math.round((d+f+e)/(g+h+i)*100);return j},o=function(a){var b=a.post_consumptions_by_type_unique,c=a.post_impressions_unique,d=angular.isDefined(b.values[0].value["photo view"])?b.values[0].value["photo view"]:0,e=angular.isDefined(b.values[0].value["other clicks"])?b.values[0].value["other clicks"]:0,f=angular.isDefined(b.values[0].value["link clicks"])?b.values[0].value["link clicks"]:0,g=0;return c.values[0].value>0&&(g=Math.round((d+e+f)/c.values[0].value*100)),g},p=function(a){var b=a.post_impressions_viral_unique,c=a.post_impressions_unique,d=0;return c.values[0].value>0&&(d=Math.round(b.values[0].value/c.values[0].value*100)),d},q=function(a){var b=a.post_negative_feedback_unique,c=a.post_impressions_unique,d=0;return c.values[0].value>0&&(d=Math.round(b.values[0].value/c.values[0].value*100)),d},r=function(a){return c.getGauge(m(a),"Taux d'engagement")},s=function(a){return c.getGauge(n(a),"Taux de conversion")},t=function(a){return c.getGauge(o(a),"Taux d'intérêt")},u=function(a){return c.getGauge(p(a),"Taux de viralité")},v=function(a){return c.getGauge(q(a),"Taux de retour négatif")},w=function(a){var b=["Engagement","Conversion","Interest","Virality","Negative"],d=[m(a),n(a),o(a),p(a),q(a)];return c.getSpider(b,d,"%","Performance du post","Taux")};return{getPageInsights:f,getPostInsights:g,getImpressions:k,getReach:l,getStoryTellers:i,getNegativeStories:j,getEngagementRateGauge:r,getConversionRateGauge:s,getInterestRateGauge:t,getViralityRateGauge:u,getNegativeRateGauge:v,getRatesSpider:w,getPages:d,getPostsByPage:e}}]).directive("ngFbPages",["$rootScope",function(a){return{restrict:"E",scope:{token:"="},templateUrl:"templates/fb-insight-pages.html",link:function(b){b.$watch("token",function(c){null!=c&&(FB.api("/me/accounts?access_token="+b.token,function(a){b.$apply(function(){b.pagesList=a.data})}),b.updatePage=function(a){FB.api("/"+a+"/feed?access_token="+b.token,function(a){b.$apply(function(){b.postsList=a.data})})},b.updatePost=function(c){FB.api("/"+c+"?access_token="+b.token,function(b){a.$broadcast("post",b.id)})})})}}}]).directive("ngFbInsight",["$templateCache","Parser",function(){return{restrict:"EA",scope:{showTitle:"=",label:"@",template:"@",data:"="},template:'<div class="template" ng-include="fbTemplateUrl"></div>',link:function(a){a.fbTemplateUrl="templates/fb-insight-"+a.template+".html"}}}]).directive("ngFbPostDetails",function(){return{restrict:"EA",scope:{postId:"=",token:"="},templateUrl:"templates/fb-post-details.html",link:function(a){a.$watch("postId",function(b){angular.isDefined(b)&&FB.api("/"+a.postId+"?access_token="+a.token,function(b){var c=b.picture;angular.isDefined(b.picture)&&null!=b.picture.match("url=(.*)")&&(c=decodeURIComponent(b.picture.match("url=(.*)")[1])),a.post={company:b.from.name,created:b.created_time,name:b.name,caption:b.caption,message:b.message,page:b.from.id,picture:c,comments:b.comments},a.$apply()})})}}}),angular.module("templates/fb-insight-bar.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-bar.html",'<div>\n  <highchart id="pie" config="data" class="pie"></highchart>\n</div>')}]),angular.module("templates/fb-insight-gauge.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-gauge.html",'<div>\n  <highchart id="pie" config="data" class="pie"></highchart>\n</div>')}]),angular.module("templates/fb-insight-geomap.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-geomap.html",'<div class="fb-insight" ng-class="api" ng-if="data">\n  <h1>{{title}}</h1>\n  <h4>{{description}}</h4>\n  <geomap data="data"></geomap>\n</div>')}]),angular.module("templates/fb-insight-map.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-map.html",'<div class="fb-insight" ng-class="api" ng-if="data">\n  <h1>{{title}}</h1>\n  <h4>{{description}}</h4>\n  <map class="map" data="data"></map>\n</div>')}]),angular.module("templates/fb-insight-pie.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-pie.html",'<div>\n  <highchart id="pie" config="data" class="pie"></highchart>\n</div>')}]),angular.module("templates/fb-insight-reach.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-reach.html",'<div>\n	<div class="value"><ng-odometer value="data"></ng-odometer></div>\n	<div class="title"><i class="fa fa-dot-circle-o"></i><span lng="text:{{label}}"></span></div>\n</div>')}]),angular.module("templates/fb-insight-spider.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-spider.html",'<div>\n  <highchart id="pie" config="data" class="pie"></highchart>\n</div>')}]),angular.module("templates/fb-post-details.html",[]).run(["$templateCache",function(a){a.put("templates/fb-post-details.html",'<div class="ng-fb-post-details" ng-if="post"><div>\n	<div class="post-header"><div>\n		<div class="page-picture"><img ng-src="http://graph.facebook.com/{{post.page}}/picture"></div>\n		<div class="page-name">{{post.company}}</div>\n		<div class="post-publish-date">{{post.created}}</div>\n	</div></div>\n\n	<div class="post-message"><div>{{post.message}}</div></div>\n\n	<div class="post-description"><div>\n		<div class="post-picture"><img ng-src="{{post.picture}}"></img></div>\n		<div class="text">\n			<div class="post-name">{{post.name}}</div>\n			<div class="post-caption">{{post.caption}}</div>\n			<div class="post-cta"></div>\n		</div>\n	</div></div>\n	<div class="post-comments">\n		<div class="comment" ng-repeat="comment in post.comments.data"><div>\n			<div class="picture"><img ng-src="http://graph.facebook.com/{{comment.from.id}}/picture?type=square"></img></div>\n			<div class="content">\n				<div class="author">{{comment.from.name}}</div>\n				<div class="message">{{comment.message}}</div>\n				<div class="created">\n					<span am-time-ago="comment.created_time"></span> <i class="fa fa-thumbs-o-up"></i><span class="likes">{{comment.like_count}}<span></div>\n				<div class="actions"></div>\n			</div>\n		</div></div>\n	</div>\n</div></div>')}]);
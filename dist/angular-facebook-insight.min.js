/*! angular-facebook-insight - v0.6.11 - 2014-11-03
* Copyright (c) 2014 ; Licensed  */
"use strict";var page_id=0;angular.module("angular-facebook-insight-tpls",["templates/fb-insight-dailyLine.html","templates/fb-insight-feedbackBreakdown.html","templates/fb-insight-genderBreakdown.html","templates/fb-insight-geomap.html","templates/fb-insight-hourlyLine","templates/fb-insight-map.html","templates/fb-insight-text.html"]),angular.module("angular-facebook-insight",["nvd3ChartDirectives","googlechart"]).service("Parser",["$filter",function(){return{getMapData:function(a,b){for(var c=[],d=a.length-1;d>=0;d--){var e=[b];for(var f in a[d].value){var g=f;f.indexOf(",")>-1&&(g=f.split(",")[0]),e.push([g,g+": "+a[d].value[f]])}c.push(e)}return c},getGeoMapData:function(a,b){for(var c=[],d=a.length-1;d>=0;d--){var e=[b];for(var f in a[d].value){var g=f;f.indexOf("_")>-1&&(g=f.split("_")[1]),e.push([g,a[d].value[f]])}c.push(e)}return c},getGauge:function(a,b){return{options:{chart:{type:"solidgauge"},pane:{center:["50%","60%"],startAngle:-90,endAngle:90,background:{backgroundColor:"#fff",innerRadius:"90%",outerRadius:"100%",shape:"arc"}},solidgauge:{dataLabels:{y:-30,borderWidth:0,useHTML:!0}},plotOptions:{solidgauge:{innerRadius:"90%",dataLabels:{y:-45,borderWidth:0,useHTML:!0}}}},series:[{data:[a],dataLabels:{format:'<div style="text-align:center"><span style="font-size:25px;color:#444">{y}</span><span style="font-size:12px;color:silver"> %</span></div>'}}],title:{text:b,y:50},credits:{enabled:!1},yAxis:{currentMin:0,currentMax:100,title:{y:140},stops:[[.1,"#DF5353"],[.5,"#DDDF0D"],[.9,"#55BF3B"]],lineWidth:0,minorTickInterval:null,tickPixelInterval:400,tickWidth:0,startOnTick:!0,labels:{y:15}},loading:!1}},getPie:function(a,b,c){return{series:[{type:"pie",name:c,data:a}],title:{text:b},loading:!1,credits:{enabled:!1}}},getBar:function(a,b,c){return{chart:{type:"bar"},title:{text:b},xAxis:{categories:["Likes","Comments","Share"]},yAxis:{min:0},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",shadow:!0},credits:{enabled:!1},series:[{name:c,type:"column",data:a,id:"series-3"}],size:{height:"300"}}},getSpider:function(a,b,c,d,e){return{chart:{polar:!0,type:"line"},title:{text:d,x:-80},pane:{size:"80%"},xAxis:{categories:a,tickmarkPlacement:"on",lineWidth:0},yAxis:{gridLineInterpolation:"polygon",lineWidth:0,min:0},credits:{enabled:!1},tooltip:{shared:!0,pointFormat:'<span style="color:{series.color}">{series.name}: <b>'+c+"{point.y:,.0f}</b><br/>"},legend:{align:"right",verticalAlign:"top",y:70,layout:"vertical"},series:[{name:e,data:b,pointPlacement:"on"}]}}}}]).service("Facebook",["$rootScope",function(a){return{getUserAndAccount:function(){FB.getLoginStatus(function(b){"connected"!==b.status?FB.login(function(b){a.$broadcast("token",b.authResponse.accessToken)},{scope:"read_insights,manage_pages"}):a.$broadcast("token",b.authResponse.accessToken)})}}}]).service("FacebookInsightService",["$rootScope","$q","Parser",function(a,b,c){var d=function(a,c){var d=b.defer();return FB.api("/"+a+"/insights?access_token="+c,function(a){d.resolve(f(a.data))}),d.promise},e=function(a,c){var d=b.defer();return FB.api("/"+a+"/insights?access_token="+c,function(a){d.resolve(f(a.data))}),d.promise},f=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a[c].name]=a[c];return b},g=function(a){var b=[a.post_storytellers_by_action_type.values[0].value.like,a.post_storytellers_by_action_type.values[0].value.comment,a.post_storytellers_by_action_type.values[0].value.share];return c.getBar(b,"Engagement par type","Type d'engagement")},h=function(a){var b=[["Payant",a.post_impressions_by_paid_non_paid.values[0].value.paid],{name:"Naturel",y:a.post_impressions_by_paid_non_paid.values[0].value.unpaid,sliced:!0,selected:!0}];return c.getPie(b,"Reach Facebook Naturel Vs Payant","Impression share")},i=function(a){return a.post_impressions_unique.values[0].value},j=function(a){var b=a.post_story_adds_by_action_type_unique,d=a.post_impressions_unique,e=angular.isDefined(b.values[0].value.like)?b.values[0].value.like:0,f=angular.isDefined(b.values[0].value.comment)?b.values[0].value.comment:0,g=angular.isDefined(b.values[0].value.share)?b.values[0].value.share:0,h=0;return d.values[0].value>0&&(h=Math.round((f+e+g)/d.values[0].value*100)),c.getGauge(h,"Taux d'engagement")},k=function(a){var b=a.post_consumptions_by_type_unique,d=a.post_story_adds_by_action_type_unique,e=angular.isDefined(d.values[0].value.like)?d.values[0].value.like:0,f=angular.isDefined(d.values[0].value.comment)?d.values[0].value.comment:0,g=angular.isDefined(d.values[0].value.share)?d.values[0].value.share:0,h=angular.isDefined(b.values[0].value["photo view"])?b.values[0].value["photo view"]:0,i=angular.isDefined(b.values[0].value["other clicks"])?b.values[0].value["other clicks"]:0,j=angular.isDefined(b.values[0].value["link clicks"])?b.values[0].value["link clicks"]:0,k=Math.round((e+g+f)/(h+i+j)*100);return c.getGauge(k,"Taux de conversion")},l=function(a){var b=a.post_consumptions_by_type_unique,d=a.post_impressions_unique,e=angular.isDefined(b.values[0].value["photo view"])?b.values[0].value["photo view"]:0,f=angular.isDefined(b.values[0].value["other clicks"])?b.values[0].value["other clicks"]:0,g=angular.isDefined(b.values[0].value["link clicks"])?b.values[0].value["link clicks"]:0,h=0;return d.values[0].value>0&&(h=Math.round((e+f+g)/d.values[0].value*100)),c.getGauge(h,"Taux d'intérêt")},m=function(a){var b=a.post_impressions_viral_unique,d=a.post_impressions_unique,e=0;return d.values[0].value>0&&(e=Math.round(b.values[0].value/d.values[0].value*100)),c.getGauge(e,"Taux de viralité")};return{getPageInsights:d,getPostInsights:e,getImpressions:h,getReach:i,getStoryTellers:g,getEngagementRate:j,getConversionRate:k,getInterestRate:l,getViralityRate:m}}]).directive("ngFbPages",["$rootScope",function(a){return{restrict:"E",scope:{token:"="},templateUrl:"templates/fb-insight-pages.html",link:function(b){b.$watch("token",function(c){null!=c&&(FB.api("/me/accounts?access_token="+b.token,function(a){b.$apply(function(){b.pagesList=a.data})}),b.updatePage=function(a){FB.api("/"+a+"/feed?access_token="+b.token,function(a){b.$apply(function(){b.postsList=a.data})})},b.updatePost=function(c){FB.api("/"+c+"?access_token="+b.token,function(b){a.$broadcast("post",b.id)})})})}}}]).directive("ngFbInsight",["$templateCache","Parser",function(){return{restrict:"EA",scope:{showTitle:"=",label:"@",template:"@",data:"="},template:'<div class="template" ng-include="fbTemplateUrl"></div>',link:function(a){a.fbTemplateUrl="templates/fb-insight-"+a.template+".html"}}}]).directive("ngFbPostDetails",function(){return{restrict:"EA",scope:{postId:"=",token:"="},templateUrl:"templates/fb-post-details.html",link:function(a){a.$watch("postId",function(b){angular.isDefined(b)&&FB.api("/"+a.postId+"?access_token="+a.token,function(b){var c=b.picture;angular.isDefined(b.picture)&&null!=b.picture.match("url=(.*)")&&(c=decodeURIComponent(b.picture.match("url=(.*)")[1])),a.post={company:b.from.name,created:b.created_time,name:b.name,caption:b.caption,message:b.message,page:b.from.id,picture:c},a.$apply()})})}}}).directive("geomap",[function(){return{restrict:"EA",scope:{data:"=",fetch:"=  "},link:function(a,b){var c=new google.visualization.GeoMap(b[0]);a.$watch("data",function(a){if(null!=a){var d=google.visualization.arrayToDataTable(a),e={dataMode:"regions",width:b.parent()[0].offsetWidth,height:220,backgroundColor:"#ffffff"};c.draw(d,e)}}),"undefined"!=typeof a.fetch&&a.fetch()}}}]).directive("map",[function(){return{restrict:"EA",scope:{data:"=",fetch:"="},link:function(a,b){var c=new google.visualization.Map(b[0]);a.$watch("data",function(a){if(null!=a){var d=google.visualization.arrayToDataTable(a),e={showTip:!0,width:b.parent()[0].offsetWidth};c.draw(d,e)}}),"undefined"!=typeof a.fetch&&a.fetch()}}}]),angular.module("templates/fb-insight-bar.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-bar.html",'<div>\n  <highchart id="pie" config="data" class="pie"></highchart>\n</div>')}]),angular.module("templates/fb-insight-gauge.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-gauge.html",'<div>\n  <highchart id="pie" config="data" class="pie"></highchart>\n</div>')}]),angular.module("templates/fb-insight-geomap.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-geomap.html",'<div class="fb-insight" ng-class="api" ng-if="data">\n  <h1>{{title}}</h1>\n  <h4>{{description}}</h4>\n  <geomap data="data"></geomap>\n</div>')}]),angular.module("templates/fb-insight-map.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-map.html",'<div class="fb-insight" ng-class="api" ng-if="data">\n  <h1>{{title}}</h1>\n  <h4>{{description}}</h4>\n  <map class="map" data="data"></map>\n</div>')}]),angular.module("templates/fb-insight-pie.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-pie.html",'<div>\n  <highchart id="pie" config="data" class="pie"></highchart>\n</div>')}]),angular.module("templates/fb-insight-reach.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-reach.html",'<div>\n	<div class="value"><ng-odometer value="data"></ng-odometer></div>\n	<div class="title"><i class="fa fa-dot-circle-o"></i><span lng="text:{{label}}"></span></div>\n</div>')}]);
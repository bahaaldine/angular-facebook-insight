/*! angular-facebook-insight - v0.6.8 - 2014-10-15
* Copyright (c) 2014 ; Licensed  */
"use strict";var page_id=0;angular.module("angular-facebook-insight-tpls",["templates/fb-insight-dailyLine.html","templates/fb-insight-feedbackBreakdown.html","templates/fb-insight-genderBreakdown.html","templates/fb-insight-geomap.html","templates/fb-insight-hourlyLine","templates/fb-insight-map.html","templates/fb-insight-text.html"]);var page_id=0;angular.module("angular-facebook-insight",["nvd3ChartDirectives","googlechart"]).service("Parser",["$filter",function(a){return{getFeedbackBreakdownData:function(b){for(var c={answer:"0,155,125",claim:"233,103,44",comment:"79,134,247",like:"221,45,41",link:"112,128,144",rsvp:"244,154,194"},d={answer:0,claim:0,comment:0,like:0,link:0,rsvp:0,data:{labels:[],datasets:[]}},e=[],f=[],g=b.length-1;g>=0;g--){d.data.labels.push(a("date")(new Date(b[g].end_time),"d MMMM yyyy"));for(var h in b[g].value)"undefined"==typeof f[h]&&(f[h]=[]),f[h].push(b[g].value[h]),d[h]+=b[g].value[h]}for(var i in f)e[i]={label:i,fillColor:"rgba("+c[i]+",0.5)",strokeColor:"rgba("+c[i]+",0.8)",highlightFill:"rgba("+c[i]+",0.75)",highlightStroke:"rgba("+c[i]+",1)",data:[]},e[i].data=f[i],d.data.datasets.push(e[i]);var j=d.answer+d.claim+d.comment+d.like+d.link+d.rsvp;return d.answer=Math.round(100*d.answer/j),d.claim=Math.round(100*d.claim/j),d.comment=Math.round(100*d.comment/j),d.like=Math.round(100*d.like/j),d.link=Math.round(100*d.link/j),d.rsvp=Math.round(100*d.rsvp/j),d},getGenderBreakdownData:function(a){for(var b=[],c=a.length-1;c>=0;c--){var d={male:0,female:0,data:{labels:[],datasets:[{label:"Female",fillColor:"rgba(222,165,164,0.5)",strokeColor:"rgba(222,165,164,0.8)",highlightFill:"rgba(222,165,164,0.75)",highlightStroke:"rgba(222,165,164,1)",data:[]},{label:"Male",fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,0.8)",highlightFill:"rgba(151,187,205,0.75)",highlightStroke:"rgba(151,187,205,1)",data:[]}]}};for(var e in a[c].value){var f=e,g=null;e.indexOf(".")>-1&&(g=e.split(".")[0],f=e.split(".")[1]),"F"==g?(d.female+=a[c].value[e],d.data.labels.push(f),d.data.datasets[0].data.push(a[c].value[e])):"M"==g&&(d.male+=a[c].value[e],d.data.datasets[1].data.push(a[c].value[e]))}var h=d.male+d.female;d.female=Math.round(100*d.female/h),d.male=Math.round(100*d.male/h),b.push(d)}return b[b.length-1]},getMapData:function(a,b){for(var c=[],d=a.length-1;d>=0;d--){var e=[b];for(var f in a[d].value){var g=f;f.indexOf(",")>-1&&(g=f.split(",")[0]),e.push([g,g+": "+a[d].value[f]])}c.push(e)}return c},getGeoMapData:function(a,b){for(var c=[],d=a.length-1;d>=0;d--){var e=[b];for(var f in a[d].value){var g=f;f.indexOf("_")>-1&&(g=f.split("_")[1]),e.push([g,a[d].value[f]])}c.push(e)}return c},getDailyLineData:function(b){for(var c={labels:[],datasets:[{label:"",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:[]}]},d=0,e=b.length;e>d;d++)c.labels[d]=a("date")(new Date(b[d].end_time),"d MMMM yyyy"),c.datasets[0].data[d]=b[d].value;return c},getHourlyLineData:function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e={labels:[],datasets:[{label:"",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:[]}]};for(var f in a[c].value)e.labels.push(f),e.datasets[0].data.push(a[c].value[f]);b.push(e)}return b[b.length-1]}}}]).service("Facebook",function(){var a=function(a,b){a.getLoginStatus(function(){a.api("/me",function(){}),a.api("/me/accounts?access_token="+b.user.accessToken,function(a){var c=[];for(var d in a.data)c[d]=a.data[d];b.monitoredPages=c,b.$apply()})})};return{getUserAndAccount:function(b,c){c.page={id:null},c.user=null,b.getLoginStatus(function(d){"connected"!==d.status?b.login(function(){b.api("/me",function(a){console.log(a),c.user=a,c.user.connected=!0,c.$apply()});var d=b.getAuthResponse().accessToken;a(b,c,d)},{scope:"read_insights,manage_pages"}):"connected"===d.status&&b.api("/me",function(d){c.user=d,c.user.connected=!0,c.user.accessToken=b.getAuthResponse().accessToken,c.$apply(),a(b,c)})})}}}).directive("ngFbUserInfo",function(){return{restrict:"E",scope:!0,transclude:!0,template:"<div>{{user.first_name}} {{user.last_name}}</div>",link:function(){}}}).directive("ngFbPages",function(){return{restrict:"E",scope:!0,template:'<select name="line" ng-model="page.id" size="1" ng-change="updatePage(page.id)"><OPTION ng-repeat="page in monitoredPages" value="{{page.id}}">{{page.name}}</option></select>',link:function(a){a.updatePage=function(){}}}}).directive("ngFbInsight",["$templateCache","Parser",function(a,b){return{restrict:"E",scope:{page:"=",token:"=",api:"@"},template:'<div ng-include="fbTemplateUrl"></div>',link:function(a,c,d){a.getAPIURL=function(a,b,c,d){return"undefined"==typeof c?"/"+a:"/"+a+"/insights/"+b+"/"+d+"?access_token="+c},a.getParser=function(c){switch(d.parser){case"geomap":a.title=c.data[0].title,a.description=c.data[0].description,a.data=b.getGeoMapData(c.data[0].values,["Country","Popularity"])[0];break;case"map":a.title=c.data[0].title,a.description=c.data[0].description,a.data=b.getMapData(c.data[0].values,["Country","Popularity"])[0];break;case"bar":a.title=c.data[0].title;break;case"feedbackBreakdown":a.title=c.data[0].title,a.description=c.data[0].description,a.data=b.getFeedbackBreakdownData(c.data[0].values);break;case"genderBreakdown":a.title=c.data[0].title,a.description=c.data[0].description,a.data=b.getGenderBreakdownData(c.data[0].values);break;case"pie":a.title=c.data[0].title;break;case"dailyLine":a.title=c.data[0].title,console.log(a.title),a.description=c.data[0].description,a.data=b.getDailyLineData(c.data[0].values);break;case"hourlyLine":a.title=c.data[0].title,a.description=c.data[0].description,a.data=b.getHourlyLineData(c.data[0].values);break;case"text":a.title="Overview",a.data=c;break;case"log":a.title=c.data[0].title,console.log(c)}},a.$watch("page",function(b){if(null!=b){a.fbTemplateUrl="templates/fb-insight-"+d.parser+".html";var c=a.getAPIURL(b,a.api,a.token,d.period);FB.api(c,function(b){("undefined"!=typeof b.about||"undefined"!=typeof b.data&&"undefined"!=typeof b.data[0])&&a.getParser(b,d.parser),a.$apply()})}})}}}]).directive("geomap",[function(){return{restrict:"EA",scope:{data:"=",fetch:"=  "},link:function(a,b){var c=new google.visualization.GeoMap(b[0]);a.$watch("data",function(a){if(null!=a){var d=google.visualization.arrayToDataTable(a),e={dataMode:"regions",width:b.parent()[0].offsetWidth,height:220,backgroundColor:"#ffffff"};c.draw(d,e)}}),"undefined"!=typeof a.fetch&&a.fetch()}}}]).directive("map",[function(){return{restrict:"EA",scope:{data:"=",fetch:"="},link:function(a,b){var c=new google.visualization.Map(b[0]);a.$watch("data",function(a){if(null!=a){var d=google.visualization.arrayToDataTable(a),e={showTip:!0,width:b.parent()[0].offsetWidth};c.draw(d,e)}}),"undefined"!=typeof a.fetch&&a.fetch()}}}]).directive("barChart",[function(){return{restrict:"EA",scope:{data:"=",fetch:"="},link:function(a,b){var c=new google.visualization.BarChart(b[0]);a.$watch("data",function(a){if(null!=a){var b=google.visualization.arrayToDataTable(a),d={hAxis:{titleTextStyle:{color:"#444"},baselineColor:"transparent",gridlines:{color:"transparent"},textPosition:"none"},vAxis:{textStyle:{fontSize:16,fontName:"Helvetica Neue",color:"#444"}},colors:["#3a589b","#c27866","#6cd08b","#d0d0d0","#5b8eca","#d6492f"],legend:{position:"none"},chartArea:{width:"60%"}};c.draw(b,d)}}),a.fetch()}}}]).directive("column",[function(){return{restrict:"EA",scope:{data:"=",fetch:"="},link:function(a,b){var c=new google.visualization.ColumnChart(b[0]);a.$watch("data",function(a){if(null!=a){var d=google.visualization.arrayToDataTable(a),e={width:b.parent()[0].offsetWidth,chartArea:{width:"60%"},bar:{groupWidth:"95%"},hAxis:{title:"Answers",titleTextStyle:{color:"#444"}},colors:["#55bc75","#3a589b","#5b8eca","#d6492f"]};c.draw(d,e)}}),a.fetch()}}}]).directive("line",[function(){return{restrict:"EA",scope:{data:"=",fetch:"="},link:function(a,b){var c=new google.visualization.LineChart(b[0]);a.$watch("data",function(a){if(null!=a){var d={width:b.parent()[0].offsetWidth,curveType:"function",chartArea:{width:"80%"},legend:{position:"bottom"},pointSize:5};c.draw(a,d)}}),a.fetch()}}}]).directive("chart",function(){var a=600,b=400;return{restrict:"E",template:"<canvas></canvas>",scope:{chartObject:"=value"},link:function(c,d,e){var f,g=d.find("canvas")[0],h=g.getContext("2d"),i={type:e.type||"Line",width:e.width||a,height:e.height||b};g.width=i.width,g.height=i.height,f=new Chart(h),c.$watch(function(){return d.attr("type")},function(a){if(a){i.type=a;var b=i.type;f[b](c.chartObject,c.chartObject.options)}}),c.$watch(function(){return c.chartObject},function(a){if(a){var b=i.type;f[b](c.chartObject,c.chartObject.options)}})}}}),angular.module("templates/fb-insight-dailyLine.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-dailyLine.html",'<div class="fb-insight" ng-class="api" ng-if="data">\n	<h1>{{title}}</h1>\n	<h4>{{description}}</h4>\n  <chart value="data"></chart>\n  <button>previous</button>\n</div>')}]),angular.module("templates/fb-insight-feedbackBreakdown.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-feedbackBreakdown.html",'<div class="fb-insight" ng-class="api" ng-if="data">\n	<h1>{{title}}</h1>\n  <h4>{{description}}</h4>\n   <ng-font-chart \n      font="fa fa-female"\n      value="data.female"\n      start-color="#3b5998"\n      end-color="rgba(255,255,255, 0.8)">\n    </ng-font-chart>\n    <chart type="Bar" value="data.data"></chart>\n\n    <ng-font-chart \n      font="fa fa-male"\n      value="data.male"\n      start-color="#3b5998"\n      end-color="rgba(255,255,255, 0.8)">\n    </ng-font-chart>\n</div>')}]),angular.module("templates/fb-insight-genderBreakdown.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-genderBreakdown.html",'<div class="fb-insight" ng-class="api" ng-if="data">\n	<h1>{{title}}</h1>\n  <h4>{{description}}</h4>\n   <ng-font-chart \n      font="fa fa-female"\n      value="data.female"\n      start-color="#3b5998"\n      end-color="rgba(255,255,255, 0.8)">\n    </ng-font-chart>\n    <chart type="Bar" value="data.data"></chart>\n\n    <ng-font-chart \n      font="fa fa-male"\n      value="data.male"\n      start-color="#3b5998"\n      end-color="rgba(255,255,255, 0.8)">\n    </ng-font-chart>\n</div>')}]),angular.module("templates/fb-insight-geomap.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-geomap.html",'<div class="fb-insight" ng-class="api" ng-if="data">\n  <h1>{{title}}</h1>\n  <h4>{{description}}</h4>\n  <geomap data="data"></geomap>\n</div>')}]),angular.module("templates/fb-insight-hourlyLine.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-hourlyLine.html",'<div class="fb-insight" ng-class="api" ng-if="data">\n  <h1>{{title}}</h1>\n  <h4>{{description}}</h4>\n  <chart value="data"></chart>\n</div>')}]),angular.module("templates/fb-insight-map.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-map.html",'<div class="fb-insight" ng-class="api" ng-if="data">\n  <h1>{{title}}</h1>\n  <h4>{{description}}</h4>\n  <map class="map" data="data"></map>\n</div>')}]),angular.module("templates/fb-insight-text.html",[]).run(["$templateCache",function(a){a.put("templates/fb-insight-text.html",'<div class="fb-insight" ng-class="api">\n  <h1>{{title}}</h1>\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.logo"></div>\n    <div class="fb-insight-image"><img src="https://graph.facebook.com/{{data.id}}/picture"></div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.cover"></div>\n    <div class="fb-insight-image"><img src="{{data.cover.source}}"></img></div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.name"></div>\n    <div class="fb-insight-value">{{data.name}}</div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.about"></div>\n    <div class="fb-insight-value">{{data.about}}</div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.category"></div>\n    <div class="fb-insight-value">{{data.category}}</div>\n      <div class="fb-insight-info" ng-repeat="category in overview.category_list">\n        <div class="fb-insight-value">{{data.name}}</div>\n      </div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.published"></div>\n    <div class="fb-insight-value">{{data.is_published}}</div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.likes.count"></div>\n    <div class="fb-insight-value">{{data.likes}}</div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.link"></div>\n    <div class="fb-insight-value">{{data.link}}</div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.link"></div>\n    <div class="fb-insight-value">{{data.link}}</div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.promotion"></div>\n    <div class="fb-insight-value">{{data.promotion_eligible}}</div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.likes.new"></div>\n    <div class="fb-insight-value">{{data.new_like_count}}</div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.talking"></div>\n    <div class="fb-insight-value">{{data.talking_about_count}}</div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.message.unread"></div>\n    <div class="fb-insight-value">{{data.unread_message_count}}</div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.message.unseen"></div>\n    <div class="fb-insight-value">{{data.unseen_message_count}}</div>\n  </div>\n\n  <div class="fb-insight-info">\n    <div class="fb-insight-label" lng="text:label.notification.unread"></div>\n    <div class="fb-insight-value">{{data.unread_notif_count}}</div>\n  </div>\n\n</div>')}]);